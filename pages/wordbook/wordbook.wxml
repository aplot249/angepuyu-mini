<view class="container list-page font-lvl-{{fontSizeLevel}} {{isDarkMode ? 'dark-mode' : ''}}">
  
  <!-- é¡¶éƒ¨å›ºå®šåŒº (æœç´¢ + Tab + å­¦ä¹ æ—¶é•¿) -->
  <view class="fixed-header">
    <view class="search-bar">
      <view class="search-icon">ğŸ”</view>
      <input class="search-input" placeholder="åœ¨æˆ‘çš„ç”Ÿè¯ä¸­æŸ¥æ‰¾{{currentTab==0?'å•è¯':'çŸ­è¯­'}}..." bindinput="onSearchInput" value="{{searchText}}" />
    </view>
    
    <!-- <view class="study-time-bar">
       <text class="time-icon">â±</text>
       <text>ç´¯è®¡å­¦ä¹ æ—¶é•¿: </text>
       <text class="time-val">{{studyTimeDisplay}}</text>
    </view> -->

    <view class="segment-tab">
      <view class="segment-item {{currentTab === 0 ? 'active' : ''}}" bindtap="switchTab" data-idx="0">å•è¯</view>
      <view class="segment-item {{currentTab === 1 ? 'active' : ''}}" bindtap="switchTab" data-idx="1">çŸ­è¯­</view>
    </view>
  </view>

  <!-- æ»‘åŠ¨å†…å®¹åŒº -->
  <swiper class="content-swiper" current="{{currentTab}}" bindchange="onSwiperChange">
    
    <!-- 1. å•è¯åˆ—è¡¨ -->
    <swiper-item>
      <scroll-view scroll-y class="scroll-area" bindscrolltolower="loadMoreWords">
        <view wx:if="{{wordList.length === 0}}" class="empty-state">
          <view class="empty-icon">ğŸ“‚</view>
          <text>è¿˜æ²¡æœ‰ç”Ÿè¯å“¦ï¼Œè¯·å…ˆåœ¨å¡ç‰‡å­¦ä¹ ä¸­æ ‡è®°~</text>
        </view>

        <block wx:for="{{wordList}}" wx:key="id">
          <!-- ç»‘å®šç‚¹å‡»å¡ç‰‡åˆ‡æ¢é€‰ä¸­çŠ¶æ€ -->
          <view class="card item-card word-layout" bindtap="playAudio"  data-id="{{item.id}}" data-type="word" data-item="{{item}}">
            
            <!-- å¤é€‰æ¡†åŒºåŸŸ (ä¿æŒåœ¨æœ€å·¦ä¾§) -->
            <view class="checkbox-area" catchtap="toggleCheck" data-id="{{item.id}}" data-type="word" data-item="{{item}}">
              <view class="custom-checkbox {{item.checked ? 'checked' : ''}}">
                <view wx:if="{{item.checked}}" class="check-mark">âœ“</view>
              </view>
            </view>
            
            <!-- å¡ç‰‡å†…å®¹ä¸»ä½“ (Flex 1 æ’‘æ»¡å³ä¾§) -->
            <view class="card-content-wrapper">
              <view class="card-main">
                <!-- å·¦ä¾§ï¼šæ ¸å¿ƒä¿¡æ¯ -->
                <view class="info-col">
                  <view class="row-flex">
                    <text class="sw-text">{{item.swahili}}</text>
                    <!-- æ’­æ”¾æŒ‰é’® (é˜»æ­¢å†’æ³¡ï¼Œé¿å…è§¦å‘å‹¾é€‰) -->
                    <view class="play-btn" catchtap="playAudio" data-item="{{item}}">ğŸ”Š</view>
                  </view>
                  
                  <view class="homonym-box">
                    <text class="tag">è°éŸ³</text>
                    <text class="hm-text">{{item.xieyin}}</text>
                  </view>

                  <view class="trans-box">
                    <text class="cn-text">{{item.chinese}}</text>
                    <text class="en-text">{{item.english || ''}}</text>
                  </view>
                </view>

                <!-- å³ä¾§ï¼šåœºæ™¯å›¾ç‰‡ (éå¿…é¡»ï¼Œæœ‰å›¾æ‰æ˜¾ç¤º) -->
                <image wx:if="{{item.portrait}}" class="word-img" src="{{item.portrait}}" mode="aspectFill" lazy-load></image>
              </view>

              <!-- åº•éƒ¨æ“ä½œæ  -->
              <view class="card-footer">
                <!-- æ”¶è—æŒ‰é’® (åœ¨å•è¯æœ¬ä¸­é»˜è®¤æ˜¯å·²æ”¶è—çŠ¶æ€) -->
                <view class="action-fav" catchtap="toggleFav"  data-id="{{item.id}}"> 
                  <text class="fav-icon active">âŒ</text>
                  <text class="fav-label active">æˆ‘å·²æŒæ¡</text>
                </view>
                <view class="action-fix">
                  <text catchtap="jiucuoCtitem" data-dd="{{item.id}}">çº é”™</text>
                </view>
              </view>
            </view>
          </view>
        </block>

        <view class="loading-tip" wx:if="{{wordList.length > 0}}">
           <text wx:if="{{hasMoreWords}}">åŠ è½½ä¸­...</text>
           <text wx:else>--- åˆ°åº•å•¦ ---</text>
        </view>
        <!-- <view style="height: 200rpx;"></view> -->
      </scroll-view>
    </swiper-item>

    <!-- 2. çŸ­è¯­åˆ—è¡¨ -->
    <swiper-item>
      <scroll-view scroll-y class="scroll-area" bindscrolltolower="loadMorePhrases">
        <view wx:if="{{phraseList.length === 0}}" class="empty-state">
          <view class="empty-icon">ğŸ“‚</view>
          <text>è¿˜æ²¡æœ‰ç”Ÿè¯å“¦ï¼Œè¯·å…ˆåœ¨å¡ç‰‡å­¦ä¹ ä¸­æ ‡è®°~</text>
        </view>

        <block wx:for="{{phraseList}}" wx:key="id">
          <view class="card item-card phrase-layout" bindtap="playAudio" data-id="{{item.id}}" data-type="phrase" data-item="{{item}}">
            
            <view class="checkbox-area" catchtap="toggleCheck" data-id="{{item.id}}" data-type="phrase" data-item="{{item}}">
              <view class="custom-checkbox {{item.checked ? 'checked' : ''}}">
                <view wx:if="{{item.checked}}" class="check-mark">âœ“</view>
              </view>
            </view>
            
            <view class="card-content-wrapper">
              <!-- é¡¶éƒ¨ï¼šæ–¯è¯­é•¿å¥ + æ’­æ”¾ -->
              <view class="phrase-header">
                <text class="sw-sentence">{{item.swahili}}</text>
                <view class="play-btn large" catchtap="playAudio" data-item="{{item}}">ğŸ”Š</view>
              </view>

              <!-- ä¸­éƒ¨ï¼šè°éŸ³ -->
              <view class="homonym-row">
                <text class="tag">è°éŸ³</text>
                <text class="hm-sentence">{{item.xieyin}}</text>
              </view>

              <!-- ä¸­éƒ¨ï¼šé‡Šä¹‰ -->
              <view class="meaning-col">
                <text class="cn-sentence">{{item.chinese}}</text>
                <text class="en-sentence">{{item.english || ''}}</text>
              </view>

              <!-- åº•éƒ¨æ“ä½œæ  -->
              <view class="card-footer phrase-footer">
                <view class="action-fav" catchtap="toggleFav"  data-id="{{item.id}}">
                  <text class="fav-icon active">âŒ</text>
                  <text class="fav-label active">æˆ‘å·²æŒæ¡</text>
                </view>
                <view class="action-fix" >
                  <text catchtap="jiucuoCtitem" data-dd="{{item.id}}">çº é”™</text>
                </view>
              </view>
            </view>

          </view>
        </block>

        <view class="loading-tip" wx:if="{{phraseList.length > 0}}">
           <text wx:if="{{hasMorePhrases}}">åŠ è½½ä¸­...</text>
           <text wx:else>--- åˆ°åº•å•¦ ---</text>
        </view>
        <!-- <view style="height: 200rpx;"></view> -->
      </scroll-view>
    </swiper-item>

  </swiper>

  <!-- å…¨å±€é®ç½©å±‚ -->
  <view class="fab-overlay" wx:if="{{isFabOpen}}" bindtap="toggleFabMenu"></view>

  <!-- å¯æ‹–åŠ¨æ‚¬æµ®æŒ‰é’®å®¹å™¨ -->
  <!-- [é‡è¦ä¿®å¤] ç§»é™¤äº†å®¹å™¨ä¸Šçš„ catchtouch äº‹ä»¶ï¼Œåªè´Ÿè´£å®šä½ -->
  <view 
    class="movable-fab-container"
    style="left: {{fabPos.x}}px; top: {{fabPos.y}}px;"
  >
    <!-- ä¸»æŒ‰é’® (èœå•å¼€å…³ & æ‹–æ‹½å¥æŸ„) -->
    <!-- [é‡è¦ä¿®å¤] æ‹–æ‹½äº‹ä»¶ç›‘å¬ç§»åˆ°è¿™é‡Œï¼Œåªå…è®¸æ‹–åŠ¨ä¸»æŒ‰é’® -->
    <view class="fab-main-btn {{isFabOpen ? 'open' : ''}}"
      catchtouchstart="onFabTouchStart"
      catchtouchmove="onFabTouchMove"
      catchtouchend="onFabTouchEnd"
    >
      <text class="main-icon">{{isFabOpen ? 'âœ•' : 'âš™ï¸'}}</text>
    </view>

    <!-- èŠ±ç“£å­èœå• (ä½¿ç”¨ catchtap ç¡®ä¿ç‚¹å‡»ç”Ÿæ•ˆå¹¶é˜»æ­¢å†’æ³¡) -->
    <!-- 1. å¡ç‰‡å¤ä¹  (top) -->
    <view class="fab-sub-item item-1 {{isFabOpen ? 'show' : ''}}" catchtap="navigateToReview">
      <view class="sub-btn cyan">ğŸ´</view>
      <text class="sub-label">å¡ç‰‡å­¦ä¹ </text>
    </view>

    <!-- 2. æ¯æ—¥ç»ƒä¹  (top-right) -->
    <view class="fab-sub-item item-2 {{isFabOpen ? 'show' : ''}}" catchtap="navigateToQuiz">
      <view class="sub-btn orange">ğŸ“</view>
      <text class="sub-label">åšé¢˜ç»ƒä¹ </text>
    </view>

    <!-- 3. ä¸²è”æ’­éŸ³ (bottom-right) -->
    <view class="fab-sub-item item-3 {{isFabOpen ? 'show' : ''}}" catchtap="playStream">
      <view class="sub-btn teal">â–¶ï¸</view>
      <text class="sub-label">ä¸²è”æ’­éŸ³</text>
    </view>

    <!-- 4. å¯¼å‡ºæ–‡æ¡£ (bottom) -->
    <!-- <view class="fab-sub-item item-4 {{isFabOpen ? 'show' : ''}}" catchtap="exportDoc">
      <view class="sub-btn blue">ğŸ“„</view>
      <text class="sub-label">å¯¼å‡ºæ–‡æ¡£</text>
    </view> -->

    <!-- 5. å…¨é€‰ (bottom-left) -->
    <view class="fab-sub-item item-5 {{isFabOpen ? 'show' : ''}}" catchtap="selectAll">
      <view class="sub-btn purple">âœ…</view>
      <text class="sub-label">å…¨é€‰</text>
    </view>

    <!-- 6. å–æ¶ˆé€‰æ‹© (top-left) -->
    <view class="fab-sub-item item-6 {{isFabOpen ? 'show' : ''}}" catchtap="unselectAll">
      <view class="sub-btn gray">â</view>
      <text class="sub-label">å–æ¶ˆé€‰æ‹©</text>
    </view>

  </view>
  
  <points-modal visible="{{showNoPointsModal}}" />

</view>