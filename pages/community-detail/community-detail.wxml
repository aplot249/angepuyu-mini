<view class="container font-lvl-{{fontSizeLevel}} {{isDarkMode ? 'dark-mode' : ''}}">
  
  <!-- å¸–å­æ­£æ–‡ -->
  <scroll-view scroll-y class="detail-scroll">
    <view class="detail-card">
      <view class="user-row">
        <image class="avatar" src="{{post.author.avatarUrl}}" mode="aspectFill"></image>
        <view class="info">
          <wxs src="../../utils/community.wxs" module="utils" />
          <text class="nick">{{post.author.nickname ? post.author.nickname : 'ç”¨æˆ·'+utils.subLastFive(post.author.openid)}}</text>
          <text class="time">{{post.time}}</text>
        </view>
        
        <!-- å³ä¾§æ“ä½œåŒº -->
        <view class="right-actions">
          <!-- wx:if="{{post.bounty > 0}}" -->
          <view class="bounty-badge" >  
            <!-- æ‚¬èµ ğŸ’{{post.bounty}} -->
            {{post.create_time}}
          </view>
          
          <!-- [æ–°å¢] å¸–å­åˆ é™¤æŒ‰é’® (ä»…è‡ªå·±å¯è§) -->
          <view class="delete-post-btn" wx:if="{{post.isSelf}}" data-id="{{post.id}}" bindtap="deletePost">
            ğŸ—‘ï¸ åˆ é™¤
          </view>
        </view>
      </view>

      <view class="content-body">
        <view class="d-title">{{post.title}}</view>
        <text class="d-text">{{post.content}}</text>
        <!-- [æ–°å¢] å›¾ç‰‡å±•ç¤ºåŒºåŸŸ -->
        <view class="img-list" wx:if="{{post.images && post.images.length > 0}}">
          <block wx:for="{{post.images}}" wx:key="*this">
            <image 
              class="post-img" 
              src="{{baseImgUrl + '/'+item.img}}" 
              mode="widthFix" 
              bindtap="previewImage" 
              data-current="{{ baseImgUrl+ '/'+ item.img}}" 
            ></image>
          </block>
        </view>
      </view>

      <view class="stat-row">
        <!-- <text>é˜…è¯» 1205</text> -->
        <text> â€¢ è¯„è®º {{comments.length}}</text>
      </view>
    </view>

    <!-- è¯„è®ºåŒº -->
    <view class="comment-section">
      <view class="section-head">å…¨éƒ¨è¯„è®º ({{comments.length}})</view>
      
      <!-- æœ‰è¯„è®ºæ—¶æ˜¾ç¤ºåˆ—è¡¨ -->
      <block wx:if="{{comments.length > 0}}">
        <block wx:for="{{comments}}" wx:key="id">
          <view class="comment-item">
            <image class="c-avatar" src="{{item.author.avatarUrl}}"></image>
            <view class="c-content">
              <view class="c-head">
                <text class="c-nick">{{item.author.nickname ? item.author.nickname : 'ç”¨æˆ·'+utils.subLastFive(item.author.openid)}}</text>
                <text class="c-floor">{{index + 1}}æ¥¼</text>
              </view>
              
              <text class="c-text">{{item.content}}</text>
              
              <view class="c-footer">
                <text class="c-time">{{item.create_time}}</text>
                <!-- ä»…è‡ªå·±å‘é€çš„æ˜¾ç¤ºåˆ é™¤ -->
                <view 
                  class="delete-text" 
                  wx:if="{{item.isSelf}}" 
                  catchtap="deleteComment" 
                  data-index="{{index}}"
                >åˆ é™¤</view>
              </view>
            </view>
          </view>
        </block>
      </block>

      <!-- æ— è¯„è®ºæ—¶çš„ç©ºçŠ¶æ€ -->
      <view class="empty-comment" wx:else>
        <text class="empty-icon">ğŸ’¬</text>
        <text class="empty-text">è¿˜æ²¡æœ‰äººè¯„è®ºï¼Œå¿«æ¥æŠ¢æ²™å‘å§~</text>
      </view>

    </view>
    
    <!-- åº•éƒ¨å«é«˜ -->
    <view style="height: 180rpx;"></view>
  </scroll-view>

  <!-- åº•éƒ¨è¯„è®ºæ  -->
  <view class="bottom-bar">
    <input 
      class="comment-input" 
      placeholder="è¯´ç‚¹ä»€ä¹ˆ..." 
      placeholder-class="ph-color" 
      bindconfirm="sendComment" 
      model:value="{{inputValue}}" 
    />
    <view class="send-btn" bindtap="sendComment">å‘é€</view>
  </view>
</view>