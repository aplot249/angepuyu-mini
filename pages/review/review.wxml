<view class="container font-lvl-{{fontSizeLevel}} {{isDarkMode ? 'dark-mode' : ''}}">
  
  <!-- 1. é¡¶éƒ¨åŠ¨æ€åŒºåŸŸ -->
  <view class="home-header" style="padding-top: {{totalNavHeight}}px; min-height: {{totalNavHeight + 140}}px;">
    <view class="header-bg"></view>
    
    <view class="header-content">
      <!-- åœºæ™¯ A: ç¬¬ä¸€å¼ å¡ç‰‡ - æ˜¾ç¤ºé—®å€™ -->
      <block wx:if="{{currentIndex === 0}}">
        <view class="greeting-box">
          <text class="greeting-title">Jambo! ğŸ‘‹</text>
          <view class="gl"></view>
          <text class="greeting-sub">æ–°çš„ä¸€å¤©ï¼Œå¼€å§‹ç§¯ç´¯è¯æ±‡å§</text>
        </view>
        <!-- <view class="today-goal">
          <text class="goal-label">ä»Šæ—¥ç›®æ ‡</text>
          <text class="goal-val">{{wordList.length}} è¯</text>
        </view> -->
      </block>

      <!-- åœºæ™¯ B: å­¦ä¹ è¿›è¡Œä¸­ - æ˜¾ç¤ºæŒ‡æ ‡ -->
      <block wx:else>
        <view class="stats-dashboard">
          
          <!-- 5ä¸ªç½‘æ ¼æ•°æ® -->
          <view class="stats-grid">
            <view class="stat-item">
              <text class="stat-num">{{knownCount}}</text>
              <text class="stat-label">å·²è®¤è¯†</text>
            </view>
            <view class="stat-line"></view>
            <view class="stat-item">
              <text class="stat-num">{{forgotCount}}</text>
              <text class="stat-label">ä¸è®¤è¯†</text>
            </view>
            <!-- <view class="stat-line"></view>
            <view class="stat-item">
              <text class="stat-num">{{completedCount}}</text>
              <text class="stat-label">å·²åšé¢˜</text>
            </view> -->
            <!-- <view class="stat-line"></view>
            <view class="stat-item">
              <text class="stat-num">{{wordList.length - completedCount}}</text>
              <text class="stat-label">å‰©ä½™</text>
            </view> -->
            <view class="stat-line"></view>
            <view class="stat-item" bind:tap="goPurchase">
              <text class="stat-num highlight">{{points}}</text>
              <text class="stat-label">ç§¯åˆ†</text>
            </view>
          </view>

        </view>
      </block>
    </view>
  </view>

  <!-- 2. å¡ç‰‡æ ¸å¿ƒå­¦ä¹ åŒº -->
  <view class="swiper-container">
    <swiper 
      class="card-swiper" 
      current="{{currentIndex}}" 
      bindchange="onSwiperChange" 
      previous-margin="40rpx" 
      next-margin="40rpx"
      circular="{{false}}"
    >
      <block wx:for="{{wordList}}" wx:key="id">
        <swiper-item class="card-swiper-item">
          <view class="flip-container {{item.isFlipped ? 'flipped' : ''}}" bindtap="toggleFlip" data-index="{{index}}">
            <view class="flipper">
              
              <!-- æ­£é¢ -->
              <view class="card-face front">
                <view class="card-inner">
                  <view class="card-status-row">
                    <!-- å ä½ç¬¦ -->
                    <view></view> 
                    <image class="tz-flag" src="https://flagcdn.com/w40/tz.png" mode="widthFix" wx:if="{{!item.portrait}}"></image>
                  </view>
                  
                  <view class="main-content-box">
                    <image class="clue-img-large" src="{{item.portrait}}" mode="aspectFill" wx:if="{{item.portrait}}"></image>
                    <view class="text-group">
                      <text class="cn-text-large">{{item.chinese}}</text>
                      <text class="en-text-sub">{{item.english}}</text>
                    </view>
                  </view>

                  <view class="bottom-hint">
                    <text class="hint-dot"></text>
                    <text>ç‚¹å‡»ç¿»è½¬</text>
                  </view>
                </view>
              </view>

              <!-- èƒŒé¢ -->
              <view class="card-face back">
                <view class="card-inner back-layout">
                  <view class="card-status-row">
                    <view class="tag-pill green">ç­”æ¡ˆ</view>
                    <view class="play-btn-mini" catchtap="playAudio" data-item="{{item}}">ğŸ”Š</view>
                  </view>
                  
                  <view class="answer-content-box">
                    <text class="sw-word-huge">{{item.swahili}}</text>
                    <view class="homonym-pill">
                      <text class="pill-label">è°éŸ³</text>
                      <text class="pill-val">{{item.xieyin}}</text>
                    </view>
                  </view>

                  <view class="action-grid">
                    <view class="action-btn forgot-btn" catchtap="markForgot" data-ctitem="{{item.id}}">
                      <text class="btn-emoji">ğŸ¤¯</text>
                      <text>ä¸è®¤è¯†</text>
                    </view>
                    <view class="action-btn known-btn" catchtap="markKnown" data-ctitem="{{item.id}}">
                      <text class="btn-emoji">ğŸ˜</text>
                      <text>è®¤è¯†</text>
                    </view>
                  </view>

                </view>
              </view>

            </view>
          </view>

        </swiper-item>
      </block>
    </swiper>
  </view>

  <!-- 3. ç§¯åˆ†ä¸è¶³å¼¹çª— -->
  <view class="modal-mask {{showNoPointsModal ? 'show' : ''}}" catchtouchmove="true">
    <view class="modal-box">
      <view class="modal-header">
        <text class="modal-icon">ğŸ’</text>
      </view>
      <view class="modal-content">
        <view class="modal-title">ç§¯åˆ†ä¸è¶³</view>
        <view class="modal-desc">æ¯å­¦ä¹ ä¸€ä¸ªå•è¯æ¶ˆè€— 3 ç§¯åˆ†ï¼Œæ‚¨å½“å‰çš„ç§¯åˆ†ä¸è¶³ï¼Œæ— æ³•ç»§ç»­ã€‚</view>
        
        <view class="modal-btns">
          <!-- åˆ†äº«æŒ‰é’® -->
          <button class="m-btn share-btn" open-type="share">
            <text>åˆ†äº«èµšç§¯åˆ†</text>
          </button>
          <!-- è´­ä¹°æŒ‰é’® -->
          <view class="m-btn buy-btn" bindtap="buyPoints">
            <text>èŠ±30å…ƒè´­ä¹°1000ç§¯åˆ†</text>
          </view>
        </view>
        
        <view class="modal-close" bindtap="closeNoPointsModal">æš‚ä¸å­¦ä¹ </view>
      </view>
    </view>
  </view>

</view>