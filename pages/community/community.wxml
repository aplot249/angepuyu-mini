<view class="container font-lvl-{{fontSizeLevel}} {{isDarkMode ? 'dark-mode' : ''}}">
  
  <!-- é¡¶éƒ¨æœç´¢ä¸åˆ†ç±» -->
  <view class="header-section">
    <!-- <view class="search-bar">
      <text class="search-icon">ğŸ”</text>
      <input 
        class="search-input" 
        placeholder="æœç´¢è¯é¢˜æˆ–å…³é”®è¯" 
        placeholder-class="ph-style" 
        bindconfirm="onSearch"
        confirm-type="search"
      />
    </view> -->

    <!-- <view class="tab-row">
      <block wx:for="{{tabs}}" wx:key="id">
        <view class="tab-item {{currentTab === index ? 'active' : ''}}" bindtap="switchTab" data-index="{{index}}">
          <text>{{item.name}}</text>
          <view class="tab-line" wx:if="{{currentTab === index}}"></view>
        </view>
      </block>
    </view> -->

    <!-- [ä¿®æ”¹] ä½¿ç”¨ scroll-view å®ç°æ¨ªå‘æ»‘åŠ¨ Tab -->
    <scroll-view 
      class="tab-scroll" 
      scroll-x 
      enable-flex 
      enhanced="{{true}}"
      show-scrollbar="{{false}}"
      scroll-with-animation
      scroll-into-view="tab-{{currentTab}}"
    >
      <view class="tab-row">
        <block wx:for="{{tabs}}" wx:key="id">
          <view 
            id="tab-{{index}}"
            class="tab-item {{currentTab === index ? 'active' : ''}}" 
            bindtap="switchTab" 
            data-index="{{index}}"
          >
            <text>{{item.name}}</text>
            <view class="tab-line" wx:if="{{currentTab === index}}"></view>
          </view>
        </block>
        <!-- å³ä¾§å ä½ï¼Œé˜²æ­¢æœ€åä¸€ä¸ª Tab è´´è¾¹å¤ªç´§ -->
        <view style="width: 30rpx; flex-shrink: 0;"></view>
      </view>
    </scroll-view>

  </view>

  <!-- [æ–°å¢] Swiper æ»‘åŠ¨åŒºåŸŸ -->
  <swiper 
    class="content-swiper" 
    current="{{currentTab}}" 
    duration="300" 
    bindchange="onSwiperChange"
  >
    <block wx:for="{{tabs}}" wx:key="id" wx:for-item="tabItem" wx:for-index="tabIdx">
      <swiper-item>
        <scroll-view 
          scroll-y 
          class="post-list-scroll" 
          bindscrolltolower="loadMore"
          enhanced
          show-scrollbar="false"
        >
          <!-- å¸–å­åˆ—è¡¨ -->
          <view class="post-list-container">
            <block wx:for="{{tabItem.list}}" wx:key="id" wx:for-item="item" wx:for-index="postIdx">
              <view class="post-card" bindtap="goToDetail" data-id="{{item.id}}">
                <!-- [æ–°å¢] ç½®é¡¶æ ‡ç­¾ -->
                <view class="top-stick-tag" wx:if="{{item.isTop}}">ç½®é¡¶</view>
                <!-- ç”¨æˆ·ä¿¡æ¯æ  -->
                <view class="card-header">
                  <image class="avatar" src="{{baseImgUrl +'/'+item.avatar}}" mode="aspectFill"></image>
                  <view class="user-meta">
                    <wxs src="../../utils/community.wxs" module="utils" />
                    <text class="nickname">{{item.nickname?item.nickname:'ç”¨æˆ·'+utils.subLastFive(item.openid)}}</text>
                    <text class="time">{{item.time}}</text>
                  </view>
                  <!-- æ‚¬èµæ ‡è®° -->
                  <!-- <view class="bounty-tag" wx:if="{{item.bounty > 0}}">
                    <text>ğŸ’ {{item.bounty}}</text>
                  </view> -->
                </view>

                <!-- å†…å®¹åŒºåŸŸ -->
                <view class="card-body">
                  <view class="post-title" wx:if="{{item.title}}">{{item.title}}</view>
                  <view class="post-content">{{item.content }}</view>
                  
                  <!-- å›¾ç‰‡ä¹å®«æ ¼ -->
                  <view class="img-grid" wx:if="{{item.images.length > 0}}">
                    <block wx:for="{{item.images}}" wx:key="*this" wx:for-item="img">
                      <image class="grid-img" src="{{baseImgUrl+'/'+img}}" mode="aspectFill" catchtap="previewImage" data-current="{{baseImgUrl+'/'+img}}" data-urls="{{item.images}}"></image>
                    </block>
                  </view>
                </view>

                <!-- åº•éƒ¨äº’åŠ¨æ  -->
                <view class="card-footer">
                  <view class="tag-box">
                    <!-- <text class="topic-tag">#{{item.topic}}</text> -->
                    <text class="topic-tag">{{item.create_time}}</text>
                  </view>
                  <view class="action-row">
                    <view class="action-btn">
                      <text>ğŸ’¬ {{item.comments}}</text>
                    </view>
                    <view class="action-btn" catchtap="onLike" data-index="{{postIdx}}">
                      <text>{{item.isLiked ? 'â¤ï¸' : 'ğŸ¤'}} {{item.likes}}</text>
                    </view>
                  </view>
                </view>

              </view>
            </block>
          </view>

          <!-- åŠ è½½çŠ¶æ€æç¤º -->
          <view class="loading-tips">
            <text wx:if="{{tabItem.isLoading}}">ğŸ”„ åŠ è½½ä¸­...</text>
            <text wx:elif="{{!tabItem.hasMore}}">- æ²¡æœ‰æ›´å¤šå†…å®¹äº† -</text>
          </view>
          
          <!-- åº•éƒ¨ç•™ç™½ -->
          <view style="height: 120rpx;"></view>
        </scroll-view>
      </swiper-item>
    </block>
  </swiper>

  <!-- æ‚¬æµ®å‘å¸–æŒ‰é’® -->
  <view class="fab-btn" bindtap="goToPost" wx:if="{{allcan}}">
    <text class="plus-icon">â•</text>
    <text class="fab-text">å‘å¸–</text>
  </view>

</view>