<view class="container font-lvl-{{fontSizeLevel}} {{isDarkMode ? 'dark-mode' : ''}}">
  
  <!-- é¡¶éƒ¨æ•°æ®ç»Ÿè®¡æ  (Quiz é£æ ¼æ‚¬æµ®å¡ç‰‡ + è½»å¾®è¾¹æ¡†) -->
  <view class="stats-header">
    <view class="stat-box">
      <view class="stat-content">
        <text class="stat-num">{{completedCount + 1}}<text class="stat-total">/{{questions.length}}</text></text>
        <text class="stat-label">è¿›åº¦</text>
      </view>
    </view>
    <view class="stat-box">
      <view class="stat-content">
        <text class="stat-num green">{{rightNum}}</text>
        <text class="stat-label">æ­£ç¡®</text>
      </view>
    </view>
    <view class="stat-box">
      <view class="stat-content">
        <text class="stat-num red">{{wrongNum}}</text>
        <text class="stat-label">é”™è¯¯</text>
      </view>
    </view>
    <view class="stat-box">
      <view class="stat-content" bind:tap="goPurchase">
        <text class="stat-num red">{{!isLoggedIn?'æ¸¸å®¢':(isvip?'å°Šè´µä¼šå‘˜':'è´­ä¹°ä¼šå‘˜')}}</text>
        <text class="stat-label">{{!isLoggedIn?'è¯·å…ˆç™»å½•':(isvip?'ä¼šå‘˜æœŸé™':'æ™®é€šç”¨æˆ·')}}</text>
      </view>
    </view>
  </view>

  <!-- æ»‘åŠ¨åŒºåŸŸ -->
  <swiper 
    class="practice-swiper" 
    current="{{currentIndex}}" 
    bindchange="onSwiperChange"
    duration="300"
  >
    <block wx:for="{{questions}}" wx:key="index" wx:for-item="item">
      <swiper-item class="p-swiper-item">
        <view class="main-card">
          
          <!-- 1. å¬éŸ³åŒº -->
          <view class="audio-section">
            <view 
              class="speaker-btn {{isPlaying && currentIndex === index ? 'playing' : ''}}" 
              bindtap="playAudio" data-item="{{item}}"
            >
              <text class="speaker-icon">ğŸ”Š</text>
              <view class="wave w1"></view>
              <view class="wave w2"></view>
            </view>
            <text class="hint-text">ç‚¹å‡»æ’­æ”¾éŸ³é¢‘</text>
          </view>

          <!-- 2. ä½œç­”åŒº -->
          <view class="answer-area">
            <view class="answer-slots">
              <block wx:for="{{item.answerSlots}}" wx:key="id" wx:for-item="word" wx:for-index="sIdx">
                <view 
                  class="word-chip filled" 
                  catchtap="removeWord" 
                  data-qindex="{{index}}" 
                  data-sindex="{{sIdx}}"
                >
                  {{word.text}}
                </view>
              </block>
              
              <view class="placeholder-line" wx:if="{{item.answerSlots.length === 0}}">
                ç‚¹å‡»ä¸‹æ–¹å•è¯ç»„å¥
              </view>
            </view>
            
            <!-- ç»“æœåé¦ˆ -->
            <view class="feedback-box {{item.status}}" wx:if="{{item.status !== 'idle'}}">
              <view class="status-row">
                <text class="status-icon">{{item.status === 'correct' ? 'âœ… æ­£ç¡®' : 'âŒ é”™è¯¯'}}</text>
              </view>
              <view class="correct-answer" wx:if="{{item.status === 'wrong'}}">
                <text class="ca-text">{{item.swahili}}</text>
              </view>
              <view class="translation">{{item.chinese}}</view>
            </view>
          </view>

          <!-- 3. é€‰è¯åŒº (è‡ªåŠ¨æ’‘æ»¡å‰©ä½™ç©ºé—´) -->
          <view class="word-bank-container">
            <view class="word-bank">
              <block wx:for="{{item.shuffledWords}}" wx:key="id" wx:for-item="word" wx:for-index="wIdx">
                <view 
                  class="word-chip bank-item {{word.selected ? 'hidden' : ''}}" 
                  catchtap="selectWord" 
                  data-qindex="{{index}}" 
                  data-windex="{{wIdx}}"
                >
                  {{word.text}}
                </view>
              </block>
            </view>
          </view>

          <!-- 4. åº•éƒ¨æŒ‰é’® -->
          <view class="card-footer">
            <button 
              wx:if="{{item.status === 'idle'}}" 
              class="btn check-btn {{item.answerSlots.length === 0 ? 'disabled' : ''}}" 
              bindtap="checkAnswer"
            >
              æ£€æŸ¥ç­”æ¡ˆ
            </button>

            <button 
              wx:elif="{{item.status === 'wrong'}}" 
              class="btn retry-btn" 
              bindtap="retryQuestion"
            >
              å†è¯•ä¸€æ¬¡
            </button>

            <button 
              wx:elif="{{item.status === 'correct'}}" 
              class="btn next-btn" 
              bindtap="nextQuestion"
            >
              ä¸‹ä¸€é¢˜
            </button>
          </view>

        </view>
      </swiper-item>
    </block>
  </swiper>

  <view class="result-overlay {{isFinished ? 'show' : ''}}">
    <view class="result-card">
      <view class="result-icon">{{score >= 60 ? 'ğŸ†' : 'ğŸ’ª'}}</view>
      <view class="result-title">{{score >= 80 ? 'æ°´å¹³ä¸é”™' : (score >= 60 ? 'ç»™ä½ ç‚¹èµ' : 'è¦ç»§ç»­åŠªåŠ›')}}</view>
      <view class="result-score">{{score}}åˆ†</view>
      <view class="result-desc">
        {{score >= 80 ? 'å¤ªæ£’äº†ï¼ä½ çš„è‘¡è¯­æ°´å¹³çªé£çŒ›è¿›ï¼' : (score >= 60 ? 'ä¸é”™å“¦ï¼Œç»§ç»­ä¿æŒï¼' : 'ä¸è¦ç°å¿ƒï¼Œå¤šç»ƒä¹ å‡ æ¬¡å°±è®°ä½äº†ã€‚')}}
        <view>æœ¬æ¬¡å…±åš{{completedCount}}é“é¢˜ï¼Œé”™{{completedCount - correctCount}}é“é¢˜ã€‚ç»§ç»­åŠ æ²¹ï¼</view>
      </view>
      <view class="result-actions">
        <button class="action-btn btn-share" open-type="share">åˆ†äº«æˆç»©</button>
        <!-- <view class="action-btn btn-restart" bindtap="retryQuestion">å†ç»ƒä¸€æ¬¡</view> -->
        <view class="action-btn btn-continue" bindtap="initAllQuestions">ç»§ç»­ç»ƒä¹ </view>
      </view>
    </view>
  </view>

  <!-- <points-modal visible="{{showNoPointsModal}}" beidong="{{beidong}}" /> -->

  <vip-modal visible="{{showNoPointsModal}}" />
  <!-- <welcome-modal></welcome-modal> -->

Â  <audio-control />
</view>