<view class="container font-lvl-{{fontSizeLevel}} {{isDarkMode ? 'dark-mode' : ''}}">
  
  <!-- 顶部进度 -->
  <view class="header-bar">
    <view class="progress-info">
      <text class="p-text">进度 {{currentIndex + 1}}/{{quizList.length}}</text>
      <text class="score-text">得分: {{score}}</text>
    </view>
    <view class="progress-track">
      <view class="progress-fill" style="width: {{((currentIndex + 1) / quizList.length) * 100}}%;"></view>
    </view>
  </view>

  <!-- 题目滑动区域 -->
  <swiper class="quiz-swiper" bindchange="onSwiperChange" current="{{currentIndex}}" previous-margin="40rpx" next-margin="40rpx">
    <block wx:for="{{quizList}}" wx:key="id" wx:for-index="qIdx" wx:for-item="quizItem">
      <swiper-item class="quiz-swiper-item">
        
        <view class="quiz-card">
          
          <!-- 题目区域 -->
          <view class="question-area">
            <view class="q-tag">单词辨析</view>
            <text class="q-word">{{quizItem.swahili}}</text>
            <view class="play-btn" catchtap="playAudio" data-word="{{quizItem.swahili}}">🔊</view>
            <text class="q-instruction">请选择正确的中文释义</text>
          </view>

          <!-- 选项区域 -->
          <view class="options-area" style="flex: 1; display: flex; flex-direction: column; justify-content: center;">
            <block wx:for="{{quizItem.options}}" wx:key="*this" wx:for-index="oIdx" wx:for-item="option">
              <view 
                class="option-btn {{quizItem.answered ? (oIdx === quizItem.answerIndex ? 'correct' : (quizItem.userChoice === oIdx ? 'wrong' : 'dim')) : ''}}" 
                bindtap="selectOption" 
                data-qindex="{{qIdx}}" 
                data-oindex="{{oIdx}}"
              >
                <text class="opt-text">{{option}}</text>
                
                <!-- 结果图标 -->
                <view class="status-icon" wx:if="{{quizItem.answered}}">
                  <text wx:if="{{oIdx === quizItem.answerIndex}}">✓</text>
                  <text wx:if="{{quizItem.userChoice === oIdx && oIdx !== quizItem.answerIndex}}">✕</text>
                </view>
              </view>
            </block>
          </view>
          
          <!-- 底部解析提示 -->
          <view class="result-hint {{quizItem.isCorrect ? 'success' : 'error'}}" style="position: relative;" wx:if="{{quizItem.answered}}">
            <text>{{quizItem.isCorrect ? '🎉 回答正确！' : '😅 再接再厉，正确答案是：' + quizItem.options[quizItem.answerIndex]}}</text>
          </view>

        </view>
      </swiper-item>
    </block>
  </swiper>

  <view class="footer-hint" bindtap="forceNext" wx:if="{{quizList[currentIndex].answered && currentIndex < quizList.length -1}}">
    点击此处或滑动进入下一题 →
  </view>

  <!-- 结果弹窗 -->
  <view class="result-overlay {{isFinished ? 'show' : ''}}">
    <view class="result-card">
      <view class="result-icon">{{score >= 80 ? '🏆' : (score >= 60 ? '👍' : '💪')}}</view>
      <view class="result-title">练习完成!</view>
      <view class="result-score">{{score}}分</view>
      <view class="result-desc">
        {{score >= 80 ? '太棒了！你的斯瓦西里语水平突飞猛进！' : (score >= 60 ? '不错哦，继续保持！' : '不要灰心，多练习几次就记住了。')}}
      </view>
      
      <view class="result-actions">
        <!-- 引导分享按钮 -->
        <button class="action-btn btn-share" open-type="share">
          分享成绩给好友
        </button>
        <view class="action-btn btn-restart" bindtap="restartQuiz">再练一次</view>
      </view>
    </view>
  </view>
</view>